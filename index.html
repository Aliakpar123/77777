<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merci Wish List</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        * { box-sizing: border-box; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-slideUp { animation: slideUp 0.4s ease-out; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }

        const BRANDS = [
            { name: '–ó–æ–ª–æ—Ç–æ–µ –Ø–±–ª–æ–∫–æ', logo: 'https://logo.clearbit.com/goldapple.ru', color: 'from-yellow-400 to-amber-500' },
            { name: 'Tiffany & Co.', logo: 'https://logo.clearbit.com/tiffany.com', color: 'from-cyan-400 to-blue-400' },
            { name: 'Cartier', logo: 'https://logo.clearbit.com/cartier.com', color: 'from-red-600 to-red-700' },
            { name: '12 STOREEZ', logo: 'https://logo.clearbit.com/12storeez.com', color: 'from-gray-800 to-black' },
            { name: 'Zara', logo: 'https://logo.clearbit.com/zara.com', color: 'from-gray-700 to-gray-900' },
            { name: 'Mango', logo: 'https://logo.clearbit.com/mango.com', color: 'from-orange-400 to-orange-500' },
            { name: 'H&M', logo: 'https://logo.clearbit.com/hm.com', color: 'from-red-500 to-red-600' },
            { name: 'Massimo Dutti', logo: 'https://logo.clearbit.com/massimodutti.com', color: 'from-amber-700 to-amber-900' },
            { name: 'Bershka', logo: 'https://logo.clearbit.com/bershka.com', color: 'from-pink-500 to-rose-600' },
            { name: 'LOVE REPUBLIC', logo: 'https://logo.clearbit.com/loverepublic.ru', color: 'from-pink-400 to-pink-600' },
            { name: 'Zarina', logo: 'https://logo.clearbit.com/zarina.ru', color: 'from-purple-400 to-purple-600' },
            { name: 'Wildberries', logo: 'https://logo.clearbit.com/wildberries.ru', color: 'from-purple-600 to-purple-800' },
            { name: 'Ozon', logo: 'https://logo.clearbit.com/ozon.ru', color: 'from-blue-600 to-blue-700' },
            { name: 'Lamoda', logo: 'https://logo.clearbit.com/lamoda.ru', color: 'from-pink-500 to-purple-600' },
            { name: 'Calzedonia', logo: 'https://logo.clearbit.com/calzedonia.com', color: 'from-rose-400 to-pink-500' }
        ];

        let currentView = 'home';
        let wishes = [];
        let showAddForm = false;
        let editingId = null;
        let formData = { title: '', shopUrl: '', price: '', image: '' };
        let isGuestMode = false;
        let guestWishes = [];
        let activeTab = 'home';
        
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –¥—Ä—É–∑–µ–π
        let friends = [];
        let friendRequests = [];
        let currentUser = null;

        function initUser() {
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
            if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
                currentUser = {
                    id: window.Telegram.WebApp.initDataUnsafe.user.id,
                    username: window.Telegram.WebApp.initDataUnsafe.user.username || 'user_' + window.Telegram.WebApp.initDataUnsafe.user.id,
                    firstName: window.Telegram.WebApp.initDataUnsafe.user.first_name,
                    lastName: window.Telegram.WebApp.initDataUnsafe.user.last_name
                };
            } else {
                // –î–µ–º–æ —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                currentUser = {
                    id: Date.now(),
                    username: 'demo_user',
                    firstName: '–î–µ–º–æ',
                    lastName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
                };
            }
            loadFriends();
        }

        function loadWishes() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareToken = urlParams.get('share');
            
            if (shareToken) {
                loadSharedWishes(shareToken);
            } else {
                const saved = localStorage.getItem('merci_wishes');
                if (saved) wishes = JSON.parse(saved);
            }
        }

        function loadFriends() {
            const saved = localStorage.getItem('merci_friends');
            if (saved) friends = JSON.parse(saved);
            
            const savedRequests = localStorage.getItem('merci_friend_requests');
            if (savedRequests) friendRequests = JSON.parse(savedRequests);
        }

        function saveFriends() {
            localStorage.setItem('merci_friends', JSON.stringify(friends));
            localStorage.setItem('merci_friend_requests', JSON.stringify(friendRequests));
        }

        async function loadSharedWishes(token) {
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
                const saved = localStorage.getItem(`share_${token}`);
                if (saved) {
                    const data = JSON.parse(saved);
                    guestWishes = data.wishes || [];
                    isGuestMode = true;
                    currentView = 'mylist';
                }
            } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫');
            }
        }

        function saveWishes() {
            localStorage.setItem('merci_wishes', JSON.stringify(wishes));
        }

        function render() {
            const app = document.getElementById('app');
            
            if (activeTab === 'home' && currentView === 'home') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-24">
                        <div class="px-6 pt-8 pb-6">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="bg-gradient-to-br from-pink-400 to-purple-500 p-3 rounded-2xl shadow-lg text-3xl">
                                    üéÅ
                                </div>
                                <div>
                                    <h1 class="text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">Merci</h1>
                                    <p class="text-sm text-gray-500">Wish List</p>
                                </div>
                            </div>

                            <button onclick="goToMyList()" class="w-full bg-gradient-to-r from-pink-400 to-purple-500 rounded-3xl p-6 mb-6 shadow-xl hover:shadow-2xl transition-all">
                                <div class="flex items-center justify-between">
                                    <div class="text-left">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="text-2xl">‚ù§Ô∏è</span>
                                            <h3 class="text-xl font-bold text-white">–ú–æ–π Wish List</h3>
                                        </div>
                                        <p class="text-pink-100 text-sm">${wishes.length > 0 ? wishes.length + ' –∂–µ–ª–∞–Ω–∏–π' : '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π —Å–ø–∏—Å–æ–∫'}</p>
                                    </div>
                                    <div class="text-2xl text-white">‚Üí</div>
                                </div>
                            </button>
                        </div>

                        <div class="px-6">
                            <h2 class="text-2xl font-bold mb-4 text-gray-700">–ò–¥–µ–∏ –ø–æ–¥–∞—Ä–∫–æ–≤</h2>
                            <div class="overflow-x-auto -mx-6 px-6">
                                <div class="flex gap-4 pb-4">
                                    ${BRANDS.map((brand, i) => `
                                        <button onclick="showBrandModal('${brand.name}')" class="flex-shrink-0 w-32 transform hover:scale-105 transition-all">
                                            <div class="bg-white rounded-3xl aspect-square flex items-center justify-center mb-2 p-4 shadow-lg hover:shadow-xl transition-all">
                                                <img src="${brand.logo}" alt="${brand.name}" class="w-full h-full object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\\'text-2xl\\'>üè™</div>'">
                                            </div>
                                            <div class="text-sm font-semibold text-center text-gray-700">${brand.name}</div>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'friends') {
                const pendingRequests = friendRequests.filter(r => r.to === currentUser.id && r.status === 'pending');
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-24">
                        <div class="px-6 pt-8 pb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üë• –î—Ä—É–∑—å—è</h1>
                                    <p class="text-gray-500">${friends.length} –¥—Ä—É–∑–µ–π</p>
                                </div>
                                <button onclick="showAddFriendModal()" class="bg-gradient-to-r from-pink-400 to-purple-500 text-white p-3 rounded-full shadow-lg hover:shadow-xl transition-all">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                    </svg>
                                </button>
                            </div>

                            ${pendingRequests.length > 0 ? `
                                <div class="mb-6">
                                    <h3 class="text-lg font-bold text-gray-700 mb-3">–ó–∞–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∑—å—è (${pendingRequests.length})</h3>
                                    <div class="space-y-3">
                                        ${pendingRequests.map(req => `
                                            <div class="bg-white rounded-2xl p-4 shadow-lg">
                                                <div class="flex items-center gap-3 mb-3">
                                                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold text-lg">
                                                        ${req.fromUsername.charAt(0).toUpperCase()}
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="font-bold text-gray-800">@${req.fromUsername}</div>
                                                        <div class="text-sm text-gray-500">–•–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ –¥—Ä—É–∑—å—è</div>
                                                    </div>
                                                </div>
                                                <div class="flex gap-2">
                                                    <button onclick="acceptFriendRequest(${req.id})" class="flex-1 bg-green-500 text-white py-2 rounded-xl font-semibold hover:bg-green-600 transition-all">
                                                        –ü—Ä–∏–Ω—è—Ç—å
                                                    </button>
                                                    <button onclick="rejectFriendRequest(${req.id})" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-xl font-semibold hover:bg-gray-400 transition-all">
                                                        –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="px-6">
                            ${friends.length === 0 ? `
                                <div class="bg-white rounded-3xl p-8 text-center shadow-lg">
                                    <div class="text-6xl mb-4">üë•</div>
                                    <p class="text-gray-600 font-medium mb-4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
                                    <button onclick="showAddFriendModal()" class="bg-gradient-to-r from-pink-400 to-purple-500 text-white px-6 py-3 rounded-2xl font-semibold hover:shadow-lg transition-all">
                                        –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞
                                    </button>
                                </div>
                            ` : `
                                <h3 class="text-lg font-bold text-gray-700 mb-3">–ú–æ–∏ –¥—Ä—É–∑—å—è</h3>
                                <div class="space-y-3">
                                    ${friends.map(friend => `
                                        <div class="bg-white rounded-2xl p-4 shadow-lg hover:shadow-xl transition-all" onclick="viewFriendWishList('${friend.username}')">
                                            <div class="flex items-center gap-3">
                                                <div class="w-14 h-14 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold text-xl">
                                                    ${friend.username.charAt(0).toUpperCase()}
                                                </div>
                                                <div class="flex-1">
                                                    <div class="font-bold text-gray-800">${friend.firstName || friend.username}</div>
                                                    <div class="text-sm text-gray-500">@${friend.username}</div>
                                                    <div class="text-sm text-pink-600 mt-1">${friend.wishCount || 0} –∂–µ–ª–∞–Ω–∏–π</div>
                                                </div>
                                                <div class="text-gray-400">
                                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } else if (activeTab === 'tasks') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-24">
                        <div class="px-6 pt-8 pb-6">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">‚ú® –ó–∞–¥–∞–Ω–∏—è</h1>
                            <p class="text-gray-500">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã</p>
                        </div>
                        <div class="px-6 space-y-4">
                            <div class="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-6 shadow-xl text-white">
                                <div class="flex items-start gap-4 mb-4">
                                    <div class="text-5xl">üì¢</div>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-xl mb-1">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</h3>
                                        <p class="text-sm opacity-90 mb-3">–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à Telegram –∫–∞–Ω–∞–ª –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å!</p>
                                        <div class="flex items-center gap-2">
                                            <div class="bg-white/20 px-3 py-1 rounded-full text-sm">+150 –±–∞–ª–ª–æ–≤ üíé</div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="subscribeToChannel()" class="w-full bg-white text-purple-600 py-3 rounded-2xl font-bold hover:bg-gray-100 transition-all">
                                    –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                                </button>
                            </div>

                            <div class="bg-gradient-to-br from-pink-500 to-rose-600 rounded-3xl p-6 shadow-xl text-white">
                                <div class="flex items-start gap-4 mb-4">
                                    <div class="text-5xl">üë•</div>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-xl mb-1">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</h3>
                                        <p class="text-sm opacity-90 mb-3">–ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å</p>
                                        <div class="flex items-center gap-2">
                                            <div class="bg-white/20 px-3 py-1 rounded-full text-sm">+200 –±–∞–ª–ª–æ–≤ üéÅ</div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="inviteFriend()" class="w-full bg-white text-pink-600 py-3 rounded-2xl font-bold hover:bg-gray-100 transition-all">
                                    –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
                                </button>
                            </div>

                            <div class="bg-white rounded-3xl p-6 shadow-lg">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">üéØ</div>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-gray-800">–î–æ–±–∞–≤–∏—Ç—å 5 –∂–µ–ª–∞–Ω–∏–π</h3>
                                        <p class="text-sm text-gray-500 mb-2">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π wish list</p>
                                        <div class="flex items-center gap-2">
                                            <div class="flex-1 bg-gray-200 rounded-full h-2">
                                                <div class="bg-pink-500 rounded-full h-2 transition-all" style="width: ${Math.min((wishes.length / 5) * 100, 100)}%"></div>
                                            </div>
                                            <span class="text-sm font-bold text-pink-600">${wishes.length}/5</span>
                                        </div>
                                    </div>
                                    <div class="text-gray-400 font-bold">+50</div>
                                </div>
                            </div>

                            <div class="bg-white rounded-3xl p-6 shadow-lg">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">üîó</div>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-gray-800">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–ø–∏—Å–∫–æ–º</h3>
                                        <p class="text-sm text-gray-500">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–∑—å—è–º</p>
                                    </div>
                                    <div class="text-gray-400 font-bold">+30</div>
                                </div>
                            </div>

                            <div class="bg-white rounded-3xl p-6 shadow-lg">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">üì∏</div>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-gray-800">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</h3>
                                        <p class="text-sm text-gray-500">–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∫ –ª—é–±–æ–º—É –∂–µ–ª–∞–Ω–∏—é</p>
                                    </div>
                                    <div class="text-gray-400 font-bold">+20</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'rating') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-24">
                        <div class="px-6 pt-8 pb-6">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">üèÜ –†–µ–π—Ç–∏–Ω–≥</h1>
                            <p class="text-gray-500">–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Merci</p>
                        </div>
                        <div class="px-6">
                            <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-3xl p-6 shadow-xl mb-6 text-white">
                                <div class="flex items-center gap-4">
                                    <div class="text-6xl">üëë</div>
                                    <div>
                                        <div class="text-sm opacity-90">–í–∞—à —Ä–µ–π—Ç–∏–Ω–≥</div>
                                        <div class="text-3xl font-bold">0 –±–∞–ª–ª–æ–≤</div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-3">
                                ${[1,2,3,4,5].map((i) => `
                                    <div class="bg-white rounded-2xl p-4 shadow-lg flex items-center gap-3">
                                        <div class="text-2xl font-bold ${i === 1 ? 'text-yellow-500' : i === 2 ? 'text-gray-400' : i === 3 ? 'text-orange-600' : 'text-gray-500'}">${i}</div>
                                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center text-white font-bold">U${i}</div>
                                        <div class="flex-1">
                                            <div class="font-bold text-gray-800">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${i}</div>
                                            <div class="text-sm text-gray-500">${1000 - i * 100} –±–∞–ª–ª–æ–≤</div>
                                        </div>
                                        ${i <= 3 ? `<div class="text-2xl">${i === 1 ? 'ü•á' : i === 2 ? 'ü•à' : 'ü•â'}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'mylist') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-24 px-6">
                        <div class="flex items-center justify-between mb-6 mt-8">
                            <button onclick="goHome()" class="text-pink-500 font-medium flex items-center gap-1">
                                <span>‚Üê</span> ${isGuestMode ? '–ó–∞–∫—Ä—ã—Ç—å' : '–ù–∞–∑–∞–¥'}
                            </button>
                        </div>
                        <h2 class="text-2xl font-bold mb-6 text-gray-700">${isGuestMode ? 'üéÅ Wish List' : '–ú–æ–π Wish List'}</h2>

                        ${!showAddForm && !isGuestMode ? `
                            <button onclick="toggleAddForm()" class="w-full bg-gradient-to-r from-pink-400 to-purple-500 rounded-3xl p-6 shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 text-white font-semibold mb-4">
                                <span class="text-2xl">‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å –∂–µ–ª–∞–Ω–∏–µ
                            </button>
                            <button onclick="shareWishList()" class="w-full bg-white border-2 border-pink-300 rounded-3xl p-6 shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 text-pink-600 font-semibold mb-6">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                                </svg>
                                –ü–æ–¥–µ–ª–∏—Ç—å—Å—è Wish List
                            </button>
                        ` : `
                            <div class="bg-white rounded-3xl p-6 shadow-lg mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-bold text-gray-800">${editingId ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤–æ–µ –∂–µ–ª–∞–Ω–∏–µ'}</h3>
                                    <button onclick="toggleAddForm()" class="text-gray-400 hover:text-gray-600">‚úï</button>
                                </div>
                                
                                <input type="text" id="wishTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ *" value="${formData.title}" class="w-full p-3 border-2 border-gray-200 rounded-2xl mb-3 focus:border-pink-400 focus:outline-none">
                                
                                <input type="url" id="imageUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ" value="${formData.image}" oninput="previewImage(this.value)" class="w-full p-3 border-2 border-gray-200 rounded-2xl mb-3 focus:border-pink-400 focus:outline-none">
                                
                                ${formData.image ? `
                                    <div class="mb-3 relative">
                                        <img src="${formData.image}" alt="Preview" class="w-full h-48 object-cover rounded-2xl" onerror="this.style.display='none'">
                                        <button type="button" onclick="removeImage()" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 shadow-lg hover:bg-red-600">
                                            ‚úï
                                        </button>
                                    </div>
                                ` : ''}
                                
                                <input type="text" id="wishPrice" placeholder="–¶–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5000 ‚Ç∏)" value="${formData.price}" class="w-full p-3 border-2 border-gray-200 rounded-2xl mb-3 focus:border-pink-400 focus:outline-none">
                                
                                <input type="url" id="shopUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω" value="${formData.shopUrl}" class="w-full p-3 border-2 border-gray-200 rounded-2xl mb-4 focus:border-pink-400 focus:outline-none">
                                
                                <button onclick="saveWish()" class="w-full bg-gradient-to-r from-pink-400 to-purple-500 text-white py-3 rounded-2xl font-semibold hover:shadow-lg transition-all">
                                    ${editingId ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å'}
                                </button>
                            </div>
                        `}

                        ${(wishes.length === 0 && guestWishes.length === 0) && !showAddForm ? `
                            <div class="bg-white rounded-3xl p-8 text-center shadow-lg mt-6">
                                <div class="text-6xl mb-4">üíù</div>
                                <p class="text-gray-600 font-medium">${isGuestMode ? '–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç' : '–ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–π —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π!'}</p>
                            </div>
                        ` : `
                            <div class="space-y-4 mt-6">
                                ${(isGuestMode ? guestWishes : wishes).map(wish => `
                                    <div class="bg-white rounded-3xl shadow-lg overflow-hidden">
                                        ${wish.image ? `
                                            <a href="${wish.shopUrl || '#'}" ${wish.shopUrl ? 'target="_blank"' : ''} class="block">
                                                <img src="${wish.image}" alt="${wish.title}" class="w-full h-48 object-cover">
                                            </a>
                                        ` : ''}
                                        <div class="p-5">
                                            <h3 class="font-bold text-lg text-gray-800 mb-2">${wish.title}</h3>
                                            ${wish.price ? `<p class="text-pink-600 font-semibold mb-2">${wish.price}</p>` : ''}
                                            ${wish.shopUrl ? `
                                                <a href="${wish.shopUrl}" target="_blank" class="inline-flex items-center gap-1 text-blue-600 text-sm mb-3">
                                                    üõí –ö—É–ø–∏—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ
                                                </a>
                                            ` : ''}
                                            ${!isGuestMode ? `
                                                <div class="flex gap-2 mt-3">
                                                    <button onclick="editWish(${wish.id})" class="p-2 text-blue-500 hover:bg-blue-50 rounded-xl">‚úé</button>
                                                    <button onclick="deleteWish(${wish.id})" class="p-2 text-red-500 hover:bg-red-50 rounded-xl">üóë</button>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `;
            }

            // –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            if (!isGuestMode) {
                const nav = document.createElement('div');
                nav.className = 'fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-2xl z-50';
                nav.innerHTML = `
                    <div class="max-w-md mx-auto px-4 py-2">
                        <div class="flex justify-around items-center">
                            <button onclick="switchTab('home')" class="flex flex-col items-center py-2 px-4 rounded-2xl transition-all ${activeTab === 'home' ? 'bg-pink-100' : ''}">
                                <svg class="w-6 h-6 ${activeTab === 'home' ? 'text-pink-600' : 'text-gray-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                <span class="text-xs mt-1 ${activeTab === 'home' ? 'text-pink-600 font-semibold' : 'text-gray-500'}">–ì–ª–∞–≤–Ω–∞—è</span>
                            </button>
                            
                            <button onclick="switchTab('friends')" class="flex flex-col items-center py-2 px-4 rounded-2xl transition-all relative ${activeTab === 'friends' ? 'bg-pink-100' : ''}">
                                ${friendRequests.filter(r => r.to === currentUser.id && r.status === 'pending').length > 0 ? `
                                    <div class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                                        ${friendRequests.filter(r => r.to === currentUser.id && r.status === 'pending').length}
                                    </div>
                                ` : ''}
                                <svg class="w-6 h-6 ${activeTab === 'friends' ? 'text-pink-600' : 'text-gray-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                <span class="text-xs mt-1 ${activeTab === 'friends' ? 'text-pink-600 font-semibold' : 'text-gray-500'}">–î—Ä—É–∑—å—è</span>
                            </button>
                            
                            <button onclick="switchTab('tasks')" class="flex flex-col items-center py-2 px-4 rounded-2xl transition-all ${activeTab === 'tasks' ? 'bg-pink-100' : ''}">
                                <svg class="w-6 h-6 ${activeTab === 'tasks' ? 'text-pink-600' : 'text-gray-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                                </svg>
                                <span class="text-xs mt-1 ${activeTab === 'tasks' ? 'text-pink-600 font-semibold' : 'text-gray-500'}">–ó–∞–¥–∞–Ω–∏—è</span>
                            </button>
                            
                            <button onclick="switchTab('rating')" class="flex flex-col items-center py-2 px-4 rounded-2xl transition-all ${activeTab === 'rating' ? 'bg-pink-100' : ''}">
                                <svg class="w-6 h-6 ${activeTab === 'rating' ? 'text-pink-600' : 'text-gray-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                                <span class="text-xs mt-1 ${activeTab === 'rating' ? 'text-pink-600 font-semibold' : 'text-gray-500'}">–†–µ–π—Ç–∏–Ω–≥</span>
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(nav);
            }
        }

        function switchTab(tab) {
            activeTab = tab;
            currentView = 'home';
            render();
        }

        function goHome() { 
            if (isGuestMode) {
                window.location.href = window.location.origin + window.location.pathname;
            } else {
                activeTab = 'home';
                currentView = 'home';
                render();
            }
        }
        
        function goToMyList() { currentView = 'mylist'; render(); }

        function toggleAddForm() {
            showAddForm = !showAddForm;
            if (!showAddForm) {
                editingId = null;
                formData = { title: '', shopUrl: '', price: '', image: '' };
            }
            render();
        }

        function previewImage(url) {
            if (url && url.startsWith('http')) {
                formData.image = url;
                render();
            }
        }

        function removeImage() {
            formData.image = '';
            render();
        }

        function saveWish() {
            const title = document.getElementById('wishTitle')?.value.trim();
            const imageUrl = document.getElementById('imageUrl')?.value.trim();
            const price = document.getElementById('wishPrice')?.value.trim();
            const shopUrl = document.getElementById('shopUrl')?.value.trim();
            
            if (!title) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!');

            if (editingId) {
                wishes = wishes.map(w => w.id === editingId ? { 
                    ...w, 
                    title, 
                    image: imageUrl,
                    price,
                    shopUrl
                } : w);
            } else {
                wishes.unshift({ 
                    id: Date.now(), 
                    title,
                    image: imageUrl,
                    price,
                    shopUrl,
                    createdAt: new Date().toISOString() 
                });
            }
            
            saveWishes();
            editingId = null;
            formData = { title: '', shopUrl: '', price: '', image: '' };
            showAddForm = false;
            render();
        }

        function editWish(id) {
            const wish = wishes.find(w => w.id === id);
            if (wish) {
                editingId = id;
                formData = { 
                    title: wish.title, 
                    image: wish.image || '',
                    price: wish.price || '',
                    shopUrl: wish.shopUrl || ''
                };
                showAddForm = true;
                render();
            }
        }

        function deleteWish(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∂–µ–ª–∞–Ω–∏–µ?')) {
                wishes = wishes.filter(w => w.id !== id);
                saveWishes();
                render();
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–∑—å—è–º–∏
        function showAddFriendModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fadeIn';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            modal.innerHTML = `
                <div class="bg-white rounded-3xl p-6 shadow-2xl max-w-sm mx-4 transform animate-slideUp w-full" onclick="event.stopPropagation()">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h3>
                    <p class="text-sm text-gray-600 mb-4">–í–≤–µ–¥–∏—Ç–µ username –¥—Ä—É–≥–∞ –≤ Telegram</p>
                    <input type="text" id="friendUsername" placeholder="@username" class="w-full p-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-pink-400 focus:outline-none">
                    <div class="flex gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-all">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button onclick="sendFriendRequest()" class="flex-1 bg-gradient-to-r from-pink-400 to-purple-500 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all">
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            setTimeout(() => document.getElementById('friendUsername')?.focus(), 100);
        }

        function sendFriendRequest() {
            const input = document.getElementById('friendUsername');
            let username = input?.value.trim();
            
            if (!username) return alert('–í–≤–µ–¥–∏—Ç–µ username!');
            
            // –£–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –µ—Å—Ç—å
            username = username.replace('@', '');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –ª–∏ –º—ã —Å–µ–±—è
            if (username === currentUser.username) {
                return alert('–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è –≤ –¥—Ä—É–∑—å—è!');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥—Ä—É–≥ –ª–∏ —É–∂–µ
            if (friends.find(f => f.username === username)) {
                return alert('–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ –≤–∞—à–µ–º —Å–ø–∏—Å–∫–µ –¥—Ä—É–∑–µ–π!');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ –∑–∞–ø—Ä–æ—Å
            if (friendRequests.find(r => r.toUsername === username && r.from === currentUser.id)) {
                return alert('–ó–∞–ø—Ä–æ—Å —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
            }
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å
            const request = {
                id: Date.now(),
                from: currentUser.id,
                fromUsername: currentUser.username,
                to: `user_${username}`, // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç ID –∏–∑ –±–∞–∑—ã
                toUsername: username,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            friendRequests.push(request);
            saveFriends();
            
            document.querySelector('.fixed')?.remove();
            alert(`–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω @${username}!`);
        }

        function acceptFriendRequest(requestId) {
            const request = friendRequests.find(r => r.id === requestId);
            if (!request) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥—Ä—É–∑—å—è
            friends.push({
                id: request.from,
                username: request.fromUsername,
                firstName: request.fromUsername,
                addedAt: new Date().toISOString(),
                wishCount: Math.floor(Math.random() * 10) // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ - –∏–∑ –±–∞–∑—ã
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞
            request.status = 'accepted';
            
            saveFriends();
            render();
        }

        function rejectFriendRequest(requestId) {
            if (confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è?')) {
                const request = friendRequests.find(r => r.id === requestId);
                if (request) {
                    request.status = 'rejected';
                    saveFriends();
                    render();
                }
            }
        }

        function viewFriendWishList(username) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–≥–∞
            alert(`–ü—Ä–æ—Å–º–æ—Ç—Ä wish list @${username} –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏!`);
        }

        function showBrandModal(brandName) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fadeIn';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            modal.innerHTML = `
                <div class="bg-white rounded-3xl p-8 shadow-2xl max-w-sm mx-4 transform animate-slideUp relative" onclick="event.stopPropagation()">
                    <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors w-8 h-8 flex items-center justify-center">
                        <span class="text-2xl">‚úï</span>
                    </button>
                    <div class="text-center">
                        <div class="text-6xl mb-4">‚ú®</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">${brandName}</h3>
                        <p class="text-gray-600">–°–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è!</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function shareWishList() {
            if (wishes.length === 0) {
                return alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∂–µ–ª–∞–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è!');
            }

            const token = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            const shareData = {
                wishes: wishes,
                createdAt: new Date().toISOString()
            };

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –¥–µ–º–æ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ - –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
            localStorage.setItem(`share_${token}`, JSON.stringify(shareData));

            const shareUrl = `${window.location.origin}${window.location.pathname}?share=${token}`;
            const text = `üéÅ –ú–æ–π Wish List –≤ Merci!\n\n–£ –º–µ–Ω—è ${wishes.length} ${wishes.length === 1 ? '–∂–µ–ª–∞–Ω–∏–µ' : '–∂–µ–ª–∞–Ω–∏–π'}.\n\n–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ–π —Å–ø–∏—Å–æ–∫:`;
            
            if (navigator.share) {
                navigator.share({ title: '–ú–æ–π Wish List', text, url: shareUrl });
            } else {
                showShareModal(shareUrl);
            }
        }

        function showShareModal(url) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fadeIn';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            modal.innerHTML = `
                <div class="bg-white rounded-3xl p-6 shadow-2xl max-w-sm mx-4 transform animate-slideUp" onclick="event.stopPropagation()">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–ø–∏—Å–∫–æ–º</h3>
                    <input type="text" value="${url}" readonly class="w-full p-3 bg-gray-100 border-2 border-gray-300 rounded-xl text-sm mb-3">
                    <button onclick="navigator.clipboard.writeText('${url}'); alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'); this.closest('.fixed').remove();" class="w-full bg-gradient-to-r from-pink-400 to-purple-500 text-white py-3 rounded-xl font-semibold">
                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function subscribeToChannel() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞!');
        }

        function inviteFriend() {
            const inviteUrl = `${window.location.origin}${window.location.pathname}?ref=${currentUser.id}`;
            const text = `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ Merci Wish List! üéÅ\n\n–°–æ–∑–¥–∞–≤–∞–π —Å–ø–∏—Å–∫–∏ –∂–µ–ª–∞–Ω–∏–π –∏ –¥–µ–ª–∏—Å—å –∏–º–∏ —Å –¥—Ä—É–∑—å—è–º–∏!`;
            
            if (navigator.share) {
                navigator.share({ title: 'Merci Wish List', text, url: inviteUrl });
            } else {
                showShareModal(inviteUrl);
            }
        }

        initUser();
        loadWishes();
        render();
    </script>
</body>
</html>
